function ngdb(n,t){var r=this,e=null,o=null,u=new ngdbUtils,i=function(){var n=null;return n=window.cordova?t.openDB("ngdb.db"):window.openDatabase("ngdb.db","1","ngdb.db",-1)};return r.init=function(n){return e=i(),r.createRepositories(n)},r.createRepositories=function(n){var t={ID:"integer primary key",STRING:"text",NUMBER:"integer",BOOLEAN:"boolean",OBJECT:"text",ARRAY:"text",DATE:"datetime"};return o=o?o:{},u._followObject(n,function(n,e){var i=[];u._followObject(n,function(r,u){t[r]||_errorHandler("Unable to find '"+r+"' datatype."),o[e]=n,i.push(u+" "+t[r])}),r.query("CREATE TABLE IF NOT EXISTS "+e+" ("+i.join(", ")+")")}),o},r.getRepository=function(n){var t=new ngdbRepository(n,r);return t},r.getDbSchema=function(){return o},r.query=function(t,r){var o=n.defer();return r="undefined"!=typeof r?r:[],e.transaction(function(n){n.executeSql(t,r,function(n,t){o.resolve(t)},function(n,t){o.reject(t)})}),o.promise},r.fetchAll=function(n){for(var t=[],r=n.rows.length,e=0;r>e;e++)t.push(n.rows.item(e));return t},r.fetch=function(n){return n.rows.length>0?n.rows.item(0):null},r}function ngdbRepository(n,t){var r=this,e=n,o=null,u=null,i=[],a=[],c=t,f=new ngdbUtils,l=function(){u=null,o=null,i=[],a=[]},s=function(n){var t=[{condition:u,value:" WHERE "+u},{condition:o,value:" ORDER BY "+o},{condition:i.length,value:" LIMIT "+i[0]+", "+i[1]}];return t.forEach(function(t){n+=t.condition?t.value:""}),n};r.setBy=function(n){var t=[];return f._followObject(n,function(n,r){t.push(r+" = ?"),a.push(n)}),u=t.join(" and "),r},r.setOrder=function(n){var t=[];return f._followObject(n,function(n,r){t.push(r+" "+n)}),o=t.join(", "),r},r.setLimit=function(n,t){return i[0]=parseInt(n,10),i[1]=parseInt(t,10),r},r.get=function(){var n="SELECT * FROM "+e;return n=s(n),c.query(n,a).then(function(n){var t=c.fetchAll(n);return t.forEach(function(n,r){t[r]=f._transformData(n,c.getDbSchema()[e])}),l(),t})},r.getOne=function(){var n="SELECT * FROM "+e;return n=s(n),c.query(n,a).then(function(n){var t=c.fetch(n);return t=f._transformData(t,c.getDbSchema()[e]),l(),Object.keys(t).length?t:null})},r.add=function(n){var t=[],r=[];n=f._transformData(n,c.getDbSchema()[e]),f._followObject(n,function(n,e){t.push(e),r.push("'"+n+"'")});var o="INSERT INTO "+e+"("+t.join(", ")+") VALUES("+r.join(", ")+")";return l(),c.query(o)},r.update=function(n){var t=[];n=f._transformData(n,c.getDbSchema()[e]),f._followObject(n,function(n,r){t.push(r+" = '"+n+"'")});var r="UPDATE "+e+" SET "+t.join(", ");return r=s(r),c.query(r,a).then(function(n){return l(),n})},r["delete"]=function(){var n="DELETE FROM "+e;return n=s(n),c.query(n,a).then(function(n){return l(),n})}}function ngdbUtils(){var n=this,t=function(n){return"object"==typeof n},r=function(n){try{JSON.parse(n)}catch(t){return!1}return!0};n._followObject=function(n,t){var r=void 0===n||null===n?[]:Object.keys(n);r.forEach(function(r){var e=n[r];void 0!==e&&null!==e&&t(e,r)})},n._transformData=function(e,o){var u={};return n._followObject(e,function(n,e){o[e]&&(t(n)?n=JSON.stringify(n):r(n)&&(n=JSON.parse(n)),u[e]=n)}),u},n._errorHandler=function(n){throw new Error("NGDB Error : "+n,"","")}}angular.module("ngDatabase",["ngCordova"]).factory("ngdb",ngdb),ngdb.$inject=["$q","$cordovaSQLite"];