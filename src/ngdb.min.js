function ngdb(n,t){var e=this,r=null,o=null,u=new ngdbUtils,i=function(){var n=null;return n=window.cordova?t.openDB("ngdb.db"):window.openDatabase("ngdb.db","1","ngdb.db",-1)};return e.init=function(n){return r=i(),e.createRepositories(n)},e.createRepositories=function(t){var r=n.defer(),i={ID:"integer primary key",STRING:"text",NUMBER:"integer",BOOLEAN:"boolean",OBJECT:"text",ARRAY:"text",DATE:"datetime"};return o=o?o:{},u._followObject(t,function(n,t){var a=[];u._followObject(n,function(e,u){i[e]||(r.reject("Unable to find '"+e+"' datatype."),_errorHandler("Unable to find '"+e+"' datatype.")),o[t]=n,a.push(u+" "+i[e])}),r.resolve(e.query("CREATE TABLE IF NOT EXISTS "+t+" ("+a.join(", ")+")"))}),r.promise},e.getRepository=function(n){var t=new ngdbRepository(n,e);return t},e.getDbSchema=function(){return o},e.query=function(t,e){var o=n.defer();return e="undefined"!=typeof e?e:[],r.transaction(function(n){n.executeSql(t,e,function(n,t){o.resolve(t)},function(n,t){o.reject(t)})}),o.promise},e.fetchAll=function(n){for(var t=[],e=n.rows.length,r=0;e>r;r++)t.push(n.rows.item(r));return t},e.fetch=function(n){return n.rows.length>0?n.rows.item(0):null},e}function ngdbRepository(n,t){var e=this,r=n,o=null,u=null,i=[],a=[],c=t,f=new ngdbUtils,l=function(){u=null,o=null,i=[],a=[]},s=function(n){var t=[{condition:u,value:" WHERE "+u},{condition:o,value:" ORDER BY "+o},{condition:i.length,value:" LIMIT "+i[0]+", "+i[1]}];return t.forEach(function(t){n+=t.condition?t.value:""}),n};e.setBy=function(n){var t=[];return f._followObject(n,function(n,e){t.push(e+" = ?"),a.push(n)}),u=t.join(" and "),e},e.setOrder=function(n){var t=[];return f._followObject(n,function(n,e){t.push(e+" "+n)}),o=t.join(", "),e},e.setLimit=function(n,t){return i[0]=parseInt(n,10),i[1]=parseInt(t,10),e},e.get=function(){var n="SELECT * FROM "+r;return n=s(n),c.query(n,a).then(function(n){var t=c.fetchAll(n);return t.forEach(function(n,e){t[e]=f._transformData(n,c.getDbSchema()[r])}),l(),t})},e.getOne=function(){var n="SELECT * FROM "+r;return e.setLimit(0,1),n=s(n),c.query(n,a).then(function(n){var t=c.fetch(n);return t=f._transformData(t,c.getDbSchema()[r]),l(),Object.keys(t).length?t:null})},e.add=function(n){var t=[],e=[];n=f._transformData(n,c.getDbSchema()[r]),f._followObject(n,function(n,r){t.push(r),e.push("'"+n+"'")});var o="INSERT INTO "+r+"("+t.join(", ")+") VALUES("+e.join(", ")+")";return l(),c.query(o)},e.update=function(n){var t=[];n=f._transformData(n,c.getDbSchema()[r]),f._followObject(n,function(n,e){t.push(e+" = '"+n+"'")});var e="UPDATE "+r+" SET "+t.join(", ");return e=s(e),c.query(e,a).then(function(n){return l(),n})},e["delete"]=function(){var n="DELETE FROM "+r;return n=s(n),c.query(n,a).then(function(n){return l(),n})}}function ngdbUtils(){var n=this,t=function(n){return"object"==typeof n},e=function(n){try{JSON.parse(n)}catch(t){return!1}return!0};n._followObject=function(n,t){var e=void 0===n||null===n?[]:Object.keys(n);e.forEach(function(e){var r=n[e];void 0!==r&&null!==r&&t(r,e)})},n._transformData=function(r,o){var u={};return n._followObject(r,function(n,r){o[r]&&(t(n)?n=JSON.stringify(n):e(n)&&(n=JSON.parse(n)),u[r]=n)}),u},n._errorHandler=function(n){throw new Error("NGDB Error : "+n,"","")}}angular.module("ngDatabase",["ngCordova"]).factory("ngdb",ngdb),ngdb.$inject=["$q","$cordovaSQLite"];