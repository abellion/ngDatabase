function ngdb(n,t){var r=this,e=null,o=null,u=new ngdbUtils,i=function(){var n=null;return n=window.cordova?t.openDB("ngdb.db"):window.openDatabase("ngdb.db","1","ngdb.db",-1)};return r.init=function(n){var t={ID:"integer primary key",STRING:"text",NUMBER:"integer",BOOLEAN:"boolean",OBJECT:"text",ARRAY:"text",DATE:"datetime"};o=n,e=i(),u._followObject(o,function(n,e){var o=[];u._followObject(n,function(n,r){t[n]||u._errorHandler("Unable to find '"+n+"' datatype."),o.push(r+" "+t[n])}),r.query("CREATE TABLE IF NOT EXISTS "+e+" ("+o.join(", ")+")")})},r.getRepository=function(n){var t=new ngdbRepository(n,r);return t},r.getDbSchema=function(){return o},r.query=function(t,r){var o=n.defer();return r="undefined"!=typeof r?r:[],e.transaction(function(n){n.executeSql(t,r,function(n,t){o.resolve(t)},function(n,t){o.reject(t)})}),o.promise},r.fetchAll=function(n){for(var t=[],r=n.rows.length,e=0;r>e;e++)t.push(n.rows.item(e));return t},r.fetch=function(n){return n.rows.item(0)},r}function ngdbRepository(n,t){var r=this,e=n,o=null,u=null,i=[],a=t,c=new ngdbUtils,f=function(){u=null,o=null,i=[]},l=function(n){var t=[{condition:u,value:" WHERE "+u},{condition:o,value:" ORDER BY "+o},{condition:i.length,value:" LIMIT "+i[0]+", "+i[1]}];return t.forEach(function(t){n+=t.condition?t.value:""}),n};r.setBy=function(n){var t=[];return c._followObject(n,function(n,r){t.push(r+" = '"+n+"'")}),u=t.join(" and "),r},r.setOrder=function(n){var t=[];return c._followObject(n,function(n,r){t.push(r+" "+n)}),o=t.join(", "),r},r.setLimit=function(n,t){return i[0]=parseInt(n,10),i[1]=parseInt(t,10),r},r.get=function(){var n="SELECT * FROM "+e;return n=l(n),a.query(n).then(function(n){var t=a.fetchAll(n);return t.forEach(function(n,r){t[r]=c._transformData(n,a.getDbSchema()[e])}),f(),t})},r.getOne=function(){var n="SELECT * FROM "+e;return n=l(n),a.query(n).then(function(n){var t=a.fetch(n);return t=c._transformData(t,a.getDbSchema()[e]),f(),t})},r.add=function(n){var t=[],r=[];n=c._transformData(n,a.getDbSchema()[e]),c._followObject(n,function(n,e){t.push(e),r.push("'"+n+"'")});var o="INSERT INTO "+e+"("+t.join(", ")+") VALUES("+r.join(", ")+")";return f(),a.query(o)},r.update=function(n){var t=[];n=c._transformData(n,a.getDbSchema()[e]),c._followObject(n,function(n,r){t.push(r+" = '"+n+"'")});var r="UPDATE "+e+" SET "+t.join(", ");return r=l(r),f(),a.query(r)},r["delete"]=function(){var n="DELETE FROM "+e;return n=l(n),f(),a.query(n)}}function ngdbUtils(){var n=this,t=function(n){return"object"==typeof n},r=function(n){try{JSON.parse(n)}catch(t){return!1}return!0};n._followObject=function(n,t){var r=Object.keys(n);r.forEach(function(r){var e=n[r];void 0!==e&&null!==e&&t(e,r)})},n._transformData=function(e,o){var u={};return n._followObject(e,function(n,e){o[e]&&(t(n)?n=JSON.stringify(n):r(n)&&(n=JSON.parse(n)),u[e]=n)}),u},n._errorHandler=function(n){throw new Error("NGDB Error : "+n,"","")}}angular.module("ngDatabase",["ngCordova"]).factory("ngdb",ngdb),ngdb.$inject=["$q","$cordovaSQLite"];