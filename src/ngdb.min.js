function ngdbProvider(){function n(n,u){var o={},a=function(){var n=null;return n=window.cordova?u.openDB("ngdb.db"):window.openDatabase("ngdb.db","1","ngdb.db",-1)},s=function(){var t=[];return ngdbUtils().browseObject(e,function(n,r){var e=[];ngdbUtils().browseObject(n,function(n,t){e.push(t+" "+i[n])}),t.push(o.query("CREATE TABLE IF NOT EXISTS "+r+" ("+e.join(", ")+")"))}),n.all(t)};return o.createRepositories=function(){return r=r?r:a(),s()},o.getRepository=function(t){return new ngdbRepository(n,o,t,e[t])},o.query=function(t,e){var i=n.defer();return e=void 0!==e&&null!==e?e:[],r.transaction(function(n){n.executeSql(t,e,function(n,t){i.resolve(t)},function(n,t){i.reject(t)})}),i.promise},o.fetchAll=function(n){for(var t=[],r=n.rows.length,e=0;r>e;e++)t.push(n.rows.item(e));return t},o.fetch=function(n){return n.rows.length>0?n.rows.item(0):null},o.setRepository=t.setRepository,o.createRepositories(),o}var t=this,r=null,e={},i={ID:"integer primary key",STRING:"text",NUMBER:"integer",BOOLEAN:"boolean",OBJECT:"text",ARRAY:"text",DATE:"datetime"};return t.setRepository=function(n,r){var u=!0;return ngdbUtils().browseObject(r,function(n){u=i[n]?u:!1}),u?e[n]=r:ngdbUtils().errorHandler("Unable to create '"+n+"' due to unknown datatype."),t},t.$get=n,t.$get.$inject=["$q","$cordovaSQLite"],t}function ngdbRepository(n,t,r,e){var i=this;return i.get=function(){var r=n.defer(),i=this.buildQuery("SELECT"),u=t.query(i.query,i.binds);return u.then(function(n){var i=t.fetchAll(n);i.forEach(function(n,t){i[t]=ngdbUtils().transformData(n,e)}),r.resolve(i)},r.reject),this.resetBuilder(),r.promise},i.getOne=function(){var r=n.defer(),i=this.setLimit(0,1).buildQuery("SELECT"),u=t.query(i.query,i.binds);return u.then(function(n){var i=ngdbUtils().transformData(t.fetch(n),e);r.resolve(i?i:null)},r.reject),this.resetBuilder(),r.promise},i.add=function(n){var r=this.buildQuery("INSERT",ngdbUtils().transformData(n,e)),i=t.query(r.query,r.binds);return this.resetBuilder(),i},i.update=function(n){var r=this.buildQuery("UPDATE",ngdbUtils().transformData(n,e)),i=t.query(r.query,r.binds);return this.resetBuilder(),i},i.delete=function(){var n=this.buildQuery("DELETE"),r=t.query(n.query,n.binds);return this.resetBuilder(),r},queryBuilder.call(i,r),i}function queryBuilder(n){var t=this,r={data:{matching:[],binds:[]},where:{matching:[],binds:[]},order:{matching:[],binds:[]},limit:{matching:[]}},e=function(){return"SELECT * FROM "+n},i=function(){var t=r.data.matching.map(function(n){return n+" = ?"});return"UPDATE "+n+" SET "+t.join(",")},u=function(){var t=r.data.matching.map(function(){return"?"});return"INSERT INTO "+n+" ("+r.data.matching.join(",")+") VALUES ("+t.join(",")+")"},o=function(){return"DELETE FROM "+n},a=function(){var n=r.where.matching.map(function(n){return n+" = ?"});return"WHERE "+n.join(" and ")},s=function(){return"ORDER BY "+r.order.matching.join(",")},c=function(){return"LIMIT "+r.limit.matching[0]+","+r.limit.matching[1]},d=function(){var n=[],t={where:a,order:s,limit:c};return ngdbUtils().browseObject(r,function(r,e){r.matching.length&&"data"!==e&&n.push(t[e].call())}),n.join(" ")};t.setData=function(n){ngdbUtils().browseObject(n,function(n,t){r.data.matching.push(t),r.data.binds.push(n)})},t.buildQuery=function(n,a){var s={SELECT:e,UPDATE:i,INSERT:u,DELETE:o};t.setData(a);var c=s[n].call()+" "+d(),l=[];return ngdbUtils().browseObject(r,function(n){n.binds&&n.binds.length&&(l=l.concat(n.binds))}),{query:c,binds:l}},t.resetBuilder=function(){r={data:{matching:[],binds:[]},where:{matching:[],binds:[]},order:{matching:[],binds:[]},limit:{matching:[]}}},t.setBy=function(n){return ngdbUtils().browseObject(n,function(n,t){r.where.matching.push(t),r.where.binds.push(n)}),t},t.setOrder=function(n){return ngdbUtils().browseObject(n,function(n,t){r.order.matching.push(t+" "+n)}),t},t.setLimit=function(n,e){return r.limit.matching[0]=parseInt(n,10),r.limit.matching[1]=parseInt(e,10),t}}function ngdbUtils(){var n=this,t=function(n){return"object"==typeof n},r=function(n){try{JSON.parse(n)}catch(t){return!1}return!0};return n.browseObject=function(n,t){for(var r in n){var e=n[r];void 0!==e&&null!==e&&t(e,r)}},n.transformData=function(e,i){var u=e?{}:null;return n.browseObject(e,function(n,e){i[e]&&(t(n)?n=angular.toJson(n):r(n)&&(n=JSON.parse(n)),u[e]=n)}),u},n.errorHandler=function(n){throw new Error("NGDB : "+n,"","")},n}angular.module("ngDatabase",["ngCordova"]).provider("ngdb",ngdbProvider);