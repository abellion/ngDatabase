!function(){function n(n,e){var o=this,u=null,a=null,i=new r,c=function(){var n=null;return n=window.cordova?e.openDB("ngdb.db"):window.openDatabase("ngdb.db","1","ngdb.db",-1)};return o.init=function(n){var t={ID:"integer primary key",STRING:"text",NUMBER:"integer",BOOLEAN:"boolean",OBJECT:"text",ARRAY:"text",DATE:"datetime"};a=n,u=c(),i._followObject(a,function(n,r){var e=[];i._followObject(n,function(n,r){t[n]||_errorHandler("Unable to find '"+n+"' datatype."),e.push(r+" "+t[n])}),o.query("CREATE TABLE IF NOT EXISTS "+r+" ("+e.join(", ")+")")})},o.getRepository=function(n){var r=new t(n,o);return r},o.getDbSchema=function(){return a},o.query=function(t,r){var e=n.defer();return r="undefined"!=typeof r?r:[],u.transaction(function(n){n.executeSql(t,r,function(n,t){e.resolve(t)},function(n,t){e.reject(t)})}),e.promise},o.fetchAll=function(n){for(var t=[],r=n.rows.length,e=0;r>e;e++)t.push(n.rows.item(e));return t},o.fetch=function(n){return n.rows.item(0)},o}function t(n,t){var e=this,o=n,u=null,a=null,i=[],c=t,f=new r,l=function(){a=null,u=null,i=[]},s=function(n){var t=[{condition:a,value:" WHERE "+a},{condition:u,value:" ORDER BY "+u},{condition:i.length,value:" LIMIT "+i[0]+", "+i[1]}];return t.forEach(function(t){n+=t.condition?t.value:""}),n};e.setBy=function(n){var t=[];return f._followObject(n,function(n,r){t.push(r+" = '"+n+"'")}),a=t.join(" and "),e},e.setOrder=function(n){var t=[];return f._followObject(n,function(n,r){t.push(r+" "+n)}),u=t.join(", "),e},e.setLimit=function(n,t){return i[0]=parseInt(n,10),i[1]=parseInt(t,10),e},e.get=function(){var n="SELECT * FROM "+o;return n=s(n),c.query(n).then(function(n){var t=c.fetchAll(n);return t.forEach(function(n,r){t[r]=f._transformData(n,c.getDbSchema()[o])}),l(),t})},e.getOne=function(){var n="SELECT * FROM "+o;return n=s(n),c.query(n).then(function(n){var t=c.fetch(n);return t=f._transformData(t,c.getDbSchema()[o]),l(),t})},e.add=function(n){var t=[],r=[];n=f._transformData(n,c.getDbSchema()[o]),f._followObject(n,function(n,e){t.push(e),r.push("'"+n+"'")});var e="INSERT INTO "+o+"("+t.join(", ")+") VALUES("+r.join(", ")+")";return l(),c.query(e)},e.update=function(n){var t=[];n=f._transformData(n,c.getDbSchema()[o]),f._followObject(n,function(n,r){t.push(r+" = '"+n+"'")});var r="UPDATE "+o+" SET "+t.join(", ");return r=s(r),l(),c.query(r)},e["delete"]=function(){var n="DELETE FROM "+o;return n=s(n),l(),c.query(n)}}function r(){var n=this,t=function(n){return"object"==typeof n},r=function(n){try{JSON.parse(n)}catch(t){return!1}return!0};n._followObject=function(n,t){var r=Object.keys(n);r.forEach(function(r){var e=n[r];void 0!==e&&null!==e&&t(e,r)})},n._transformData=function(e,o){var u={};return n._followObject(e,function(n,e){o[e]&&(t(n)?n=JSON.stringify(n):r(n)&&(n=JSON.parse(n)),u[e]=n)}),u},n._errorHandler=function(n){throw new Error("NGDB Error : "+n,"","")}}angular.module("ngDatabase",["ngCordova"]).factory("ngdb",n),n.$inject=["$q","$cordovaSQLite"]}();
