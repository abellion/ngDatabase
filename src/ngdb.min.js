function ngdb(n,t,r){var e=this,o=null,u={},i=new ngdbUtils,a=function(){var n=null;return n=window.cordova?t.openDB("ngdb.db"):window.openDatabase("ngdb.db","1","ngdb.db",-1)};return e.init=function(n){return o=a(),e.createRepositories(n)},e.createRepositories=function(t){var o=[];return i._followObject(t,function(n,t){var a=[];i._followObject(n,function(n,t){r.TYPES[n]||_errorHandler("Unable to find '"+n+"' datatype."),a.push(t+" "+r.TYPES[n])}),u[t]=n,o.push(e.query("CREATE TABLE IF NOT EXISTS "+t+" ("+a.join(", ")+")"))}),n.all(o)},e.getRepository=function(n){var t=new ngdbRepository(n,e);return t},e.getDbSchema=function(){return u},e.query=function(t,r){var e=n.defer();return r=void 0!==r&&null!==r?r:[],o.transaction(function(n){n.executeSql(t,r,function(n,t){e.resolve(t)},function(n,t){e.reject(t)})}),e.promise},e.fetchAll=function(n){for(var t=[],r=n.rows.length,e=0;r>e;e++)t.push(n.rows.item(e));return t},e.fetch=function(n){return n.rows.length>0?n.rows.item(0):null},e}function ngdbRepository(n,t){var r=this,e=n,o=null,u=null,i=[],a=[],c=t,f=new ngdbUtils,l=function(){u=null,o=null,i=[],a=[]},s=function(n){var t=[{condition:u,value:" WHERE "+u},{condition:o,value:" ORDER BY "+o},{condition:i.length,value:" LIMIT "+i[0]+", "+i[1]}];return t.forEach(function(t){n+=t.condition?t.value:""}),n};r.setBy=function(n){var t=[];return f._followObject(n,function(n,r){t.push(r+" = ?"),a.push(n)}),u=t.join(" and "),r},r.setOrder=function(n){var t=[];return f._followObject(n,function(n,r){t.push(r+" "+n)}),o=t.join(", "),r},r.setLimit=function(n,t){return i[0]=parseInt(n,10),i[1]=parseInt(t,10),r},r.get=function(){var n="SELECT * FROM "+e;return n=s(n),c.query(n,a).then(function(n){var t=c.fetchAll(n);return t.forEach(function(n,r){t[r]=f._transformData(n,c.getDbSchema()[e])}),l(),t})},r.getOne=function(){var n="SELECT * FROM "+e;return r.setLimit(0,1),n=s(n),c.query(n,a).then(function(n){var t=c.fetch(n);return t=f._transformData(t,c.getDbSchema()[e]),l(),Object.keys(t).length?t:null})},r.add=function(n){var t=[],r=[],o=[];n=f._transformData(n,c.getDbSchema()[e]),f._followObject(n,function(n,e){t.push(e),r.push(n),o.push("?")});var u="INSERT INTO "+e+"("+t.join(", ")+") VALUES("+o.join(", ")+")";return l(),c.query(u,r)},r.update=function(n){var t=[],r=[];n=f._transformData(n,c.getDbSchema()[e]),f._followObject(n,function(n,e){t.push(n),r.push(e+" = ?")});var o="UPDATE "+e+" SET "+r.join(", ");return o=s(o),c.query(o,t.concat(a)).then(function(n){return l(),n})},r["delete"]=function(){var n="DELETE FROM "+e;return n=s(n),c.query(n,a).then(function(n){return l(),n})}}function ngdbUtils(){var n=this,t=function(n){return"object"==typeof n},r=function(n){try{JSON.parse(n)}catch(t){return!1}return!0};n._followObject=function(n,t){var r=void 0===n||null===n?[]:Object.keys(n);r.forEach(function(r){var e=n[r];void 0!==e&&null!==e&&t(e,r)})},n._transformData=function(e,o){var u={};return n._followObject(e,function(n,e){o[e]&&(t(n)?n=JSON.stringify(n):r(n)&&(n=JSON.parse(n)),u[e]=n)}),u},n._errorHandler=function(n){throw new Error("NGDB Error : "+n,"","")}}angular.module("ngDatabase",["ngCordova"]).constant("CONSTANTS",{TYPES:{ID:"integer primary key",STRING:"text",NUMBER:"integer",BOOLEAN:"boolean",OBJECT:"text",ARRAY:"text",DATE:"datetime"}}).factory("ngdb",ngdb),ngdb.$inject=["$q","$cordovaSQLite","CONSTANTS"];