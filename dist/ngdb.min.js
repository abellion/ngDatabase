function ngdbProvider(n){var t=this;return t.repositorySchema={},t.setRepository=function(e,r){var i=!0;return ngdbUtils().browseObject(r,function(t){i=n[t]?i:!1}),i?t.repositorySchema[e]=r:ngdbUtils().errorHandler("Unable to create '"+e+"' due to unknown datatype."),t},t.$get=ngdbFactory,t}function ngdbFactory(n,t,e,r,i){var u=this,a={};return a.createRepositories=function(){var t=[],a=u.repositorySchema;return e.browseObject(a,function(n,u){var a=[];e.browseObject(n,function(n,t){a.push(t+" "+i[n])}),t.push(r.make("CREATE TABLE IF NOT EXISTS "+u+" ("+a.join(", ")+")"))}),n.all(t)},a.getRepository=function(n){var e=t.instantiate(ngdbRepository,{ngdbQueryBuilder:t.instantiate(ngdbQueryBuilder)}),r=u.repositorySchema[n];return e.ngdbRepositorySetRepository(n,r),e},a.getRepositorySchema=function(n){return u.repositorySchema[n]||null},a.getQueryMaker=function(){return r},a.createRepositories(),a}function ngdbQuery(n,t){var e=this,r=null,i=function(){return r=window.cordova?t.openDB("ngdb.db"):window.openDatabase("ngdb.db","1","ngdb.db",-1)};return e.make=function(t,e){var i=n.defer();return e=void 0!==e&&null!==e?e:[],r.transaction(function(n){n.executeSql(t,e,function(n,t){i.resolve(t)},function(n,t){i.reject(t)})}),i.promise},e.fetchAll=function(n){for(var t=[],e=n.rows.length,r=0;e>r;r++)t.push(n.rows.item(r));return t},e.fetch=function(n){return n.rows.length>0?n.rows.item(0):null},i(),e}function ngdbRepository(n,t,e,r,i,u,a){var o=this,c=!1,d=null,s=null;o.ngdbRepositorySetRepository=function(n,t){return d=n,s=t,i.ngdbQueryBuilderSetRepository(n),o},o.setDataBinding=function(n){return c=n===!0,o};var l=function(n){var t=r.fetchAll(n);return t&&t.forEach(function(n,e){t[e]=a.convertDataToGet(n,s)}),t},b=function(n){var t=a.convertDataToGet(r.fetch(n),s);return t?t:null},g=function(n,t,e){c&&u.bind(d,n,t,e)},f=function(n){n.then(function(){u.update(d)})};return o.get=function(){var t=n.defer(),e=this.buildQuery("SELECT"),i=r.make(e.query,e.binds);return i.then(function(n){var r=l(n);t.resolve(r),g(e,l,r)},t.reject),this.resetBuilder(),t.promise},o.getOne=function(){var t=n.defer(),e=this.setLimit(0,1).buildQuery("SELECT"),i=r.make(e.query,e.binds);return i.then(function(n){var r=b(n);t.resolve(r),g(e,b,r)},t.reject),this.resetBuilder(),t.promise},o.add=function(n){n=a.convertDataToAdd(n,s);var t=this.buildQuery("INSERT",n),e=r.make(t.query,t.binds);return f(e),this.resetBuilder(),e},o.update=function(n){n=a.convertDataToAdd(n,s);var t=this.buildQuery("UPDATE",n),e=r.make(t.query,t.binds);return f(e),this.resetBuilder(),e},o.delete=function(){var n=this.buildQuery("DELETE"),t=r.make(n.query,n.binds);return f(t),this.resetBuilder(),t},angular.extend(o,i),o}function ngdbDataBinding(n,t){var e=this,r={},i=function(n,t){return t&&t.forEach(function(e,r){n[r]=t[r]}),n&&n.forEach(function(e,r){t[r]||n.pop()}),n},u=function(n,e){return e&&t.browseObject(e,function(t,e){n[e]=t}),n&&t.browseObject(n,function(t,r){e&&e[r]||delete n[r]}),n},a=function(n,t){return t instanceof Array?i(n,t):t instanceof Object?u(n,t):u(n,t)};return e.bind=function(n,t,e,i){return n&&t&&e&&i?(r[n]=r[n]?r[n]:[],void r[n].push({query:t,dataFormater:e,watcher:i})):0},e.update=function(t){var e=r[t];e&&e.forEach(function(t){var e=n.make(t.query.query,t.query.binds);e.then(function(n){var e=t.dataFormater.call(null,n);a(t.watcher,e)})})},e}function ngdbDataConverter(n){var t=this,e=function(n){var t=null;try{t=angular.fromJson(n)}catch(e){return!1}return t},r=function(n){return angular.isObject(n)&&angular.toJson(n)||null},i=function(n){return e(n)||null},u=function(n){return n instanceof Date&&n.getTime()||null},a=function(n){return isFinite(n)&&new Date(n)||null},o=function(n){return isFinite(n)&&parseInt(n,10)||null},c=function(n){return isFinite(n)&&parseInt(n,10)||null},d=function(n){return n===!0?!0:!1},s=function(n){return"true"===n?!0:!1},l=function(n,t){var e={OBJECT:r,ARRAY:r,DATE:u,BOOLEAN:d,NUMBER:o};return e[t]?e[t].call(null,n):n},b=function(n,t){var e={OBJECT:i,ARRAY:i,DATE:a,BOOLEAN:s,NUMBER:c};return e[t]?e[t].call(null,n):n},g=function(t,e,r){var i=t?{}:null;return n.browseObject(t,function(n,t){e&&e[t]&&(i[t]=r(n,e[t]))}),i};return t.convertDataToAdd=function(n,t){return g(n,t,l)},t.convertDataToGet=function(n,t){return g(n,t,b)},t}function ngdbQueryBuilder(n){var t=this,e={data:{matching:[],binds:[]},where:{matching:[],binds:[]},order:{matching:[],binds:[]},limit:{matching:[]},table:null},r=function(){return"SELECT * FROM "+e.table},i=function(){var n=e.data.matching.map(function(n){return n+" = ?"});return"UPDATE "+e.table+" SET "+n.join(",")},u=function(){var n=e.data.matching.map(function(){return"?"});return"INSERT INTO "+e.table+" ("+e.data.matching.join(",")+") VALUES ("+n.join(",")+")"},a=function(){return"DELETE FROM "+e.table},o=function(){var n=e.where.matching.map(function(n){return n+" = ?"});return"WHERE "+n.join(" and ")},c=function(){return"ORDER BY "+e.order.matching.join(",")},d=function(){return"LIMIT "+e.limit.matching[0]+","+e.limit.matching[1]},s=function(){var t=[],r={where:o,order:c,limit:d};return n.browseObject(e,function(n,e){n.matching&&n.matching.length&&"data"!==e&&t.push(r[e].call())}),t.join(" ")};return t.ngdbQueryBuilderSetRepository=function(n){return e.table=n,this},t.setData=function(t){n.browseObject(t,function(n,t){e.data.matching.push(t),e.data.binds.push(n)})},t.buildQuery=function(o,c){var d={SELECT:r,UPDATE:i,INSERT:u,DELETE:a};t.setData(c);var l=d[o].call()+" "+s(),b=[];return n.browseObject(e,function(n){n.binds&&n.binds.length&&(b=b.concat(n.binds))}),{query:l,binds:b}},t.resetBuilder=function(){e={data:{matching:[],binds:[]},where:{matching:[],binds:[]},order:{matching:[],binds:[]},limit:{matching:[]},table:e.table}},t.setBy=function(t){return n.browseObject(t,function(n,t){e.where.matching.push(t),e.where.binds.push(n)}),this},t.setOrder=function(t){return n.browseObject(t,function(n,t){e.order.matching.push(t+" "+n)}),this},t.setLimit=function(n,t){return e.limit.matching[0]=parseInt(n,10),e.limit.matching[1]=parseInt(t,10),this},t}function ngdbUtils(){var n=this;return n.browseObject=function(n,t){for(var e in n){var r=n[e];void 0!==r&&null!==r&&t(r,e)}},n.errorHandler=function(n){throw new Error("NGDB : "+n,"","")},n}angular.module("ngDatabase",["ngCordova"]).constant("NGDB_TYPES",{ID:"integer primary key",STRING:"text",NUMBER:"integer",BOOLEAN:"boolean",OBJECT:"text",ARRAY:"text",DATE:"datetime"}),angular.module("ngDatabase").provider("ngdb",ngdbProvider),ngdbProvider.$inject=["NGDB_TYPES"],ngdbFactory.$inject=["$q","$injector","ngdbUtils","ngdbQuery","NGDB_TYPES"],angular.module("ngDatabase").factory("ngdbQuery",ngdbQuery),ngdbQuery.$inject=["$q","$cordovaSQLite"],angular.module("ngDatabase").service("ngdbRepository",ngdbRepository),ngdbRepository.$inject=["$q","$injector","ngdbUtils","ngdbQuery","ngdbQueryBuilder","ngdbDataBinding","ngdbDataConverter"],angular.module("ngDatabase").factory("ngdbDataBinding",ngdbDataBinding),ngdbDataBinding.$inject=["ngdbQuery","ngdbUtils"],angular.module("ngDatabase").factory("ngdbDataConverter",ngdbDataConverter),ngdbDataConverter.$inject=["ngdbUtils"],angular.module("ngDatabase").service("ngdbQueryBuilder",ngdbQueryBuilder),ngdbQueryBuilder.$inject=["ngdbUtils"],angular.module("ngDatabase").factory("ngdbUtils",ngdbUtils),ngdbUtils.$inject=[];