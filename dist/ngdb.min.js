function ngdbProvider(n){var t=this;return t.repositorySchema={},t.setRepository=function(e,r){var i=!0;return ngdbUtils().browseObject(r,function(t){i=n[t]?i:!1}),i?t.repositorySchema[e]=r:ngdbUtils().errorHandler("Unable to create '"+e+"' due to unknown datatype."),t},t.$get=ngdbFactory,t}function ngdbFactory(n,t,e,r,i){var a=this,o={};return o.createRepositories=function(){var r=[],o=a.repositorySchema;return t.browseObject(o,function(n,a){var o=[];t.browseObject(n,function(n,t){o.push(t+" "+i[n])}),r.push(e.make("CREATE TABLE IF NOT EXISTS "+a+" ("+o.join(", ")+")"))}),n.all(r)},o.getRepository=function(n){var t=r.ngdbRepositoryGetNew(),e=a.repositorySchema[n];return t.ngdbRepositorySetRepository(n,e),t},o.createRepositories(),o}function ngdbQuery(n,t){var e=this,r=null,i=function(){return r=window.cordova?t.openDB("ngdb.db"):window.openDatabase("ngdb.db","1","ngdb.db",-1)};return e.make=function(t,e){var i=n.defer();return e=void 0!==e&&null!==e?e:[],r.transaction(function(n){n.executeSql(t,e,function(n,t){i.resolve(t)},function(n,t){i.reject(t)})}),i.promise},e.fetchAll=function(n){for(var t=[],e=n.rows.length,r=0;e>r;r++)t.push(n.rows.item(r));return t},e.fetch=function(n){return n.rows.length>0?n.rows.item(0):null},i(),e}function ngdbRepository(n,t,e,r,i){var a=this,o=!1,u=null,c=null;a.ngdbRepositoryGetNew=function(){return new ngdbRepository(n,t,e,r.ngdbBuilderGetNew(),i)},a.ngdbRepositorySetRepository=function(n,t){return u=n,c=t,r.ngdbBuilderSetRepository(n),a},a.setDataBinding=function(n){return o=n===!0,a};var d=function(n){var r=e.fetchAll(n);return r&&r.forEach(function(n,e){r[e]=t.transformData(n,c)}),r},s=function(n){var r=t.transformData(e.fetch(n),c);return r?r:null},b=function(n,t,e){o&&i.bind(u,n,t,e)},l=function(n){n.then(function(){i.update(u)})};return a.get=function(){var t=n.defer(),r=this.buildQuery("SELECT"),i=e.make(r.query,r.binds);return i.then(function(n){var e=d(n);t.resolve(e),b(r,d,e)},t.reject),this.resetBuilder(),t.promise},a.getOne=function(){var t=n.defer(),r=this.setLimit(0,1).buildQuery("SELECT"),i=e.make(r.query,r.binds);return i.then(function(n){var e=s(n);t.resolve(e),b(r,s,e)},t.reject),this.resetBuilder(),t.promise},a.add=function(n){var r=this.buildQuery("INSERT",t.transformData(n,c)),i=e.make(r.query,r.binds);return l(i),this.resetBuilder(),i},a.update=function(n){var r=this.buildQuery("UPDATE",t.transformData(n,c)),i=e.make(r.query,r.binds);return l(i),this.resetBuilder(),i},a.delete=function(){var n=this.buildQuery("DELETE"),t=e.make(n.query,n.binds);return l(t),this.resetBuilder(),t},angular.extend(a,r),a}function ngdbDataBinding(n,t){var e=this,r={},i=function(n,t){return t&&t.forEach(function(e,r){n[r]=t[r]}),n&&n.forEach(function(e,r){t[r]||n.pop()}),n},a=function(n,e){return e&&t.browseObject(e,function(t,e){n[e]=t}),n&&t.browseObject(n,function(t,r){e&&e[r]||delete n[r]}),n},o=function(n,t){return t instanceof Array?i(n,t):t instanceof Object?a(n,t):a(n,t)};return e.bind=function(n,t,e,i){return n&&t&&e&&i?(r[n]=r[n]?r[n]:[],void r[n].push({query:t,dataFormater:e,watcher:i})):0},e.update=function(t){var e=r[t];e&&e.forEach(function(t){var e=n.make(t.query.query,t.query.binds);e.then(function(n){var e=t.dataFormater.call(null,n);o(t.watcher,e)})})},e}function ngdbBuilder(n){var t=this,e={data:{matching:[],binds:[]},where:{matching:[],binds:[]},order:{matching:[],binds:[]},limit:{matching:[]},table:null},r=function(){return"SELECT * FROM "+e.table},i=function(){var n=e.data.matching.map(function(n){return n+" = ?"});return"UPDATE "+e.table+" SET "+n.join(",")},a=function(){var n=e.data.matching.map(function(){return"?"});return"INSERT INTO "+e.table+" ("+e.data.matching.join(",")+") VALUES ("+n.join(",")+")"},o=function(){return"DELETE FROM "+e.table},u=function(){var n=e.where.matching.map(function(n){return n+" = ?"});return"WHERE "+n.join(" and ")},c=function(){return"ORDER BY "+e.order.matching.join(",")},d=function(){return"LIMIT "+e.limit.matching[0]+","+e.limit.matching[1]},s=function(){var t=[],r={where:u,order:c,limit:d};return n.browseObject(e,function(n,e){n.matching&&n.matching.length&&"data"!==e&&t.push(r[e].call())}),t.join(" ")};return t.ngdbBuilderSetRepository=function(n){return e.table=n,this},t.ngdbBuilderGetNew=function(){return new ngdbBuilder(n)},t.setData=function(t){n.browseObject(t,function(n,t){e.data.matching.push(t),e.data.binds.push(n)})},t.buildQuery=function(u,c){var d={SELECT:r,UPDATE:i,INSERT:a,DELETE:o};t.setData(c);var b=d[u].call()+" "+s(),l=[];return n.browseObject(e,function(n){n.binds&&n.binds.length&&(l=l.concat(n.binds))}),{query:b,binds:l}},t.resetBuilder=function(){e={data:{matching:[],binds:[]},where:{matching:[],binds:[]},order:{matching:[],binds:[]},limit:{matching:[]},table:e.table}},t.setBy=function(t){return n.browseObject(t,function(n,t){e.where.matching.push(t),e.where.binds.push(n)}),this},t.setOrder=function(t){return n.browseObject(t,function(n,t){e.order.matching.push(t+" "+n)}),this},t.setLimit=function(n,t){return e.limit.matching[0]=parseInt(n,10),e.limit.matching[1]=parseInt(t,10),this},t}function ngdbUtils(){var n=this,t=function(n){return"object"==typeof n},e=function(n){try{JSON.parse(n)}catch(t){return!1}return!0};return n.browseObject=function(n,t){for(var e in n){var r=n[e];void 0!==r&&null!==r&&t(r,e)}},n.transformData=function(r,i){var a=r?{}:null;return n.browseObject(r,function(n,r){(i&&i[r]||!i)&&(t(n)?n=angular.toJson(n):e(n)&&(n=angular.fromJson(n)),a[r]=n)}),a},n.errorHandler=function(n){throw new Error("NGDB : "+n,"","")},n}angular.module("ngDatabase",["ngCordova"]).constant("NGDB_TYPES",{ID:"integer primary key",STRING:"text",NUMBER:"integer",BOOLEAN:"boolean",OBJECT:"text",ARRAY:"text",DATE:"datetime"}),angular.module("ngDatabase").provider("ngdb",ngdbProvider),ngdbProvider.$inject=["NGDB_TYPES"],ngdbFactory.$inject=["$q","ngdbUtils","ngdbQuery","ngdbRepository","NGDB_TYPES"],angular.module("ngDatabase").factory("ngdbQuery",ngdbQuery),ngdbQuery.$inject=["$q","$cordovaSQLite"],angular.module("ngDatabase").service("ngdbRepository",ngdbRepository),ngdbRepository.$inject=["$q","ngdbUtils","ngdbQuery","ngdbBuilder","ngdbDataBinding"],angular.module("ngDatabase").factory("ngdbDataBinding",ngdbDataBinding),ngdbDataBinding.$inject=["ngdbQuery","ngdbUtils"],angular.module("ngDatabase").service("ngdbBuilder",ngdbBuilder),ngdbBuilder.$inject=["ngdbUtils"],angular.module("ngDatabase").factory("ngdbUtils",ngdbUtils),ngdbUtils.$inject=[];